{"version":3,"file":"godmode-template-browser.element-6VMGtxq1.js","sources":["../../../assets/src/workspace/godmode/views/godmode-template-browser.element.ts"],"sourcesContent":["import { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\nimport { LitElement, css, customElement, html, state } from \"@umbraco-cms/backoffice/external/lit\";\nimport { tryExecuteAndNotify } from \"@umbraco-cms/backoffice/resources\";\nimport { UUIInputEvent, UUISelectEvent } from \"@umbraco-cms/backoffice/external/uui\";\nimport type { UmbTableColumn, UmbTableConfig, UmbTableElement, UmbTableItem, UmbTableOrderedEvent } from '@umbraco-cms/backoffice/components';\nimport { GodModeService, TemplateModel } from \"../../../api\";\nimport { sortData } from \"../../../helpers/sort\";\nimport { DirectionModel } from \"@umbraco-cms/backoffice/external/backend-api\";\n\n@customElement('godmode-template-browser')\nexport class GodModeTemplateBrowserElement extends UmbElementMixin(LitElement) {\n\n  @state()\n  private _tableConfig: UmbTableConfig = {\n    allowSelection: false,\n    hideIcon: true\n  }\n\n  @state()\n  private _tableColumns: Array<UmbTableColumn> = [\n    {\n      name: 'Partial Name',\n      alias: 'name',\n      allowSorting: true\n    },\n    {\n      name: 'Template Name',\n      alias: 'templateName',\n      allowSorting: true\n    }\n  ];\n\n  @state()\n  private _tableItems: Array<UmbTableItem> = [];\n\n  @state()\n  templates: TemplateModel[] = [];\n\n  @state()\n  filteredData: TemplateModel[] = [];\n\n  @state()\n  searchName: string = '';\n\n  @state()\n  masterOptions: Option[] = [];\n\n  @state()\n  selectedMaster: string = '';\n\n  @state()\n  partialOptions: Option[] = [];\n\n  @state()\n  selectedPartial: string = '';\n\n  constructor() {\n    super();\n  }\n\n  async connectedCallback() {\n    super.connectedCallback();\n    this.#loadTemplates();\n  }\n\n  #sortingHandler(event: UmbTableOrderedEvent) {\n    const table = event.target as UmbTableElement;\n    const orderingColumn = table.orderingColumn as keyof TemplateModel;\n    const orderingDesc = table.orderingDesc;\n\n    this.filteredData = sortData(structuredClone(this.templates), orderingColumn, orderingDesc ? DirectionModel.DESCENDING : DirectionModel.ASCENDING);\n    this._tableItems = this.#mapData(this.filteredData);\n  }\n\n  async #loadTemplates() {\n    const { data } = await tryExecuteAndNotify(this, GodModeService.getUmbracoManagementApiV1GodModeGetTemplates());\n\n    if (data) {\n      this.templates = data;\n      this.filteredData = structuredClone(this.templates);\n      this._tableItems = this.#mapData(this.filteredData);\n\n      let partials = [...new Set(this.templates.map(x => x.partials).reduce((a, b) => { return a.concat(b) }))];\n      this.partialOptions = partials.map(x => { return { name: x.name, value: x.name } });\n      this.partialOptions.unshift({ name: 'Any', value: '', selected: true });\n\n      let masters = [...new Set(this.templates.filter(x => x.isMaster))];\n      this.masterOptions = masters.map(x => { return { name: x.name, value: x.id.toString() } });\n      this.masterOptions.unshift({ name: 'Any', value: '', selected: true });\n    }\n  }\n\n  #mapData(data: TemplateModel[]): UmbTableItem[] {\n    return data.map((data) => {\n      return {\n        id: data.name,\n        data: [\n          {\n            columnAlias: 'name',\n            value: data.name\n          }\n        ]\n      }\n    });\n  }\n\n  #setSearchName(event: UUIInputEvent) {\n    const value = event.target.value as string;\n    this.searchName = value;\n    this.#filterValues();\n  }\n\n  #setSelectedMaster(event: UUISelectEvent) {\n    const value = event.target.value as string;\n    this.selectedMaster = value;\n    this.#filterValues();\n  }\n\n  #setSelectedPartial(event: UUISelectEvent) {\n    const value = event.target.value as string;\n    this.selectedMaster = value;\n    this.#filterValues();\n  }\n\n  #filterValues() {\n    this.filteredData = structuredClone(this.templates);\n\n    if (this.searchName !== '') {\n      this.filteredData = this.filteredData?.filter(x => x.name.toLowerCase().includes(this.searchName));\n    }\n\n    if (this.selectedMaster !== '') {\n      this.filteredData = this.filteredData?.filter(x => x.masterAlias?.toLowerCase().includes(this.selectedMaster));\n    }\n\n    if (this.selectedPartial !== '') {\n      this.filteredData = this.filteredData?.filter(x => x.partials?.some(y => y.name === this.selectedPartial));\n    }\n\n    if (this.filteredData) {\n      this._tableItems = this.#mapData(this.filteredData);\n    }\n    else this._tableItems = [];\n  }\n\n  override render() {\n    return html`\n            <umb-body-layout>\n                <godmode-header name=\"Template Browser\" slot=\"header\"></godmode-header>\n                <uui-box>\n                    <div class=\"grid\">\n                        <div>\n                            <uui-label>Search:</uui-label>\n                            <uui-input\n                                placeholder=\"Filter template names\"\n                                .value=${this.searchName}\n                                @input=${this.#setSearchName}>\n                            </uui-input>\n                        </div>\n                        <div>\n                            <uui-label>Uses Master:</uui-label>\n                            <uui-select\n                                .options=${this.masterOptions}\n                                .value=${this.selectedMaster}\n                                @change=${this.#setSelectedMaster}>\n                            </uui-select>\n                        </div>\n                        <div>\n                            <uui-label>Uses Partial:</uui-label>\n                            <uui-select\n                                .options=${this.partialOptions}\n                                .value=${this.selectedPartial}\n                                @change=${this.#setSelectedPartial}>\n                            </uui-select>\n                        </div>\n                    </div>\n                </uui-box>\n\n                ${this._tableItems.length !== 0 ?\n        html`\n                    <uui-box style=\"--uui-box-default-padding: 0;\">\n                        <umb-table .config=${this._tableConfig} .columns=${this._tableColumns} .items=${this._tableItems} @ordered=${this.#sortingHandler} />\n                    </uui-box>\n                ` : html``}\n            </umb-body-layout>\n        `;\n  }\n\n  static styles = [\n    css`\n            .grid {\n                display: grid;\n                grid-template-columns: repeat(3, 1fr);\n                gap: 20px;\n\n                div {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: flex-start;\n                }\n            }\n\n            uui-box {\n\t            margin-bottom: 20px;\n            }\n\n            .inline-flex {\n                display: inline-flex;\n                align-items: center;\n\n                uui-icon {\n                    margin-right: 6px;\n                }\n            }\n        `\n  ]\n}\n\nexport default GodModeTemplateBrowserElement;\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'godmode-template-browser': GodModeTemplateBrowserElement;\n  }\n}\n"],"names":["_sortingHandler","sortingHandler_fn","_loadTemplates","loadTemplates_fn","_mapData","mapData_fn","_setSearchName","setSearchName_fn","_setSelectedMaster","setSelectedMaster_fn","_setSelectedPartial","setSelectedPartial_fn","_filterValues","filterValues_fn","GodModeTemplateBrowserElement","UmbElementMixin","LitElement","__privateAdd","__privateMethod","html","event","table","orderingColumn","orderingDesc","sortData","DirectionModel","data","tryExecuteAndNotify","GodModeService","partials","x","b","masters","value","_a","_b","_c","y","css","__decorateClass","state","customElement","GodModeTemplateBrowserElement$1"],"mappings":"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"}